  #include<stdio.h>
main()
{
	menu();
}
menu()
{
	int n,w; /* 变量n保存选择菜单数字,w判断输入的数字是否在功能菜单对应数字范围内*/
	do
	{
		printf("\t\t**********************\n\n");
		printf("\n\t\t\t\t1.enter new data");
		printf("\n\t\t\t\t2.search data");
		printf("\n\t\t\t\t3.modify data");
		printf("\n\t\t\t\t4.delete data");
		printf("\n\t\t\t\t5.exit");
		printf("\n\n\t\t*************************************\n");
		printf("choose number(1-6):[]\b\b");
		scanf("%d",&n);
		if(n<1||n>5)  /*对选择的数字作判断*/
		{
			w=1;
			getchar();
		}
		else 
			w=0;
	}
	while(w==1);
	switch(n)
	{
	case 1:enter();break; /*输入模块*/
	case 2:search();break; /*查找模块*/
    case 3:modify();break;/*修改模块*/
	case 4:delete();break;/*删除模块*/
	case 5:exit(0); /*退出*/
	default:printf("error\n");
	}
}
  struct machine
{
char name[10];
       char number[50];
       char buy_time[10];
char borrowin_time[10];
char borrowout_time[10];
       char return_time[10];
       char repair_time[10];
char sta[5];
       char time[5];/*time为下面程序中按时间查找和修改时记录输入的时间*/
}
equip[N];/* equip[N]中每个数组元素对应一个仪表仪器*/
/*************************输入模块***********************/
#include<stdio.h>
Void newin() /*输入模块*/
{
int i,n;
printf(“录入仪器仪表的数量：”);
scanf(“%d”,&n);
printf(“\n录入日期\n\n”);
printf(“\n名称 编号 购买时间 借出时间 归还时间 维修时间 状态 \n”);
for(i=0;i<n;i++)
{
input(i);  /* 调用输入函数*/
}
If(i!=0) save(n); /*  调用保存函数*/
Printf back(); /*一个任务结束时让用户选择是浏览还是返回*/

/******************查找功能*****************/
void search()
{
int m;
puts(“\t\t*******************************************\n\n”);
puts(“\t\t\t\t1.common search”);
puts(“\t\t\t\t2.point search”);
puts(“\t\t\t\t3.exit”);
puts(“\n\n\t\t*********************************\n”);
printf(“\n choose your number (1-3):[]\b\b”);
scanf(“%d”,&m);
switch(m)
{
case 1:common search();break;
case 2:point search();
case 3:exit(0);
}
}
/*************************基本查找模块***********************/
 int common_search()                                     /*基本查找模块*/
{
 int i,n,k,w1=1,w2,w3,w4;
  struct machine m;
  n=load();
  printf("Search the machine by name  or number?1-name,2-number:");
  scanf("%d",&i);
  if(i==1)
{
do
{
do
{
 k=-1;
           printf("\n\nEnter the machine name that you want to search!   name:");
           scanf("%s",m.name);            /*输入要查找的仪器仪表的名称*/
           printf_face();                       /*调用显示数据结构项目函数*/
           for(i=0;i<n;i++)                           /*查找想要的记录*/
           if(strcmp(m.name,mac[i].name)==0)
             {
 k=i;                                /*找到要查找的记录*/
	           printf_one(k);                     /*调用显示一个记录的函数*/
             }
           if(k==-1)
            {
 printf("\n\nNO exist! please");
              printf("\n\nAre you again?\n\t1).again   2).NO and back  []\b\b");
              scanf("%d",&w1);
              while(w1==1)  menu();/*保证第一次查找的基础上再查找找不到时能退出*/
             }
         }
          while(k==-1&&w1==1);                   /*如果w1!=1则直接返回*/
         w4=0;w3=0;
        if(k!=-1)                            /*k!=-1表示找到，如果找到则选择操作*/
          {printf("\n\nWhat do you want to do?\n\t1).Search another  2).Modify  3).Delete  4).Back menu  []\b\b");
           scanf("%d",&w2);
           switch(w2)
	      {case 2:w3=modify_data(k);break;             /*调用修改数据函数*/
	       case 3:{printf("\nAre you sure?\n\t1).Sure   2).No and back  []\b\b");
	       scanf("%d",&w4);
	      }
	    }
        if(w3==1||w4==1)
	  {save(n);
	   printf("\n\nSuccessful.^_^.");
	   printf("\n\nWhat do you want to do?\n\t1).Search another   2).Back   []\b\b");
	   scanf("%d",&w2);
	  }
	}
       }
      while(w2==1);
  }
   if(i==2)
     {do
         {do
            { k=-1;
              printf("\n\nEnter the machine number that you want to search!   number:");
              scanf("%s",m.number);               /*输入要查找的仪器仪表编号*/
              printf_face();                       /*调用显示数据结构项目函数*/
              for(i=0;i<n;i++)                          /*查找想要的记录*/
              if(strcmp(m.number,mac[i].number)==0)
                { k=i;                                   /*找到要查找的记录*/
	          printf_one(k);                           /*调用显示一个记录的函数*/
                }
              if(k==-1)
               {printf("\n\nNO exist! please");
                printf("\n\nAre you again?\n\t1).again   2).NO and back  []\b\b");                 scanf("%d",&w1);
                while(w1==1)menu();/*保证第一次查找的基础上再查找找不到时能退出*/
                  }
             }
          while(k==-1&&w1==1);                          /*如果w1!=1则直接返回*/
          w4=0;w3=0;
          if(k!=-1)                          /*k!=-1表示找到，如果找到则选择操作*/
            { printf("\n\nWhat do you want to do?\n\t1).Search another  2).Modify  3).Delete  4).Back menu  []\b\b");
              scanf("%d",&w2);
              switch(w2)
	          { case 2:w3=modify_data(k);break;             /*调用修改数据函数*/
	            case 3:{printf("\nAre you sure?\n\t1).Sure   2).No and back  []\b\b");
	            scanf("%d",&w4);
	           }
	    }
          if(w3==1||w4==1)
	    { save(n);
	      printf("\n\nSuccessful.^_^.");
	      printf("\n\nWhat do you want to do?\n\t1).Search another   2).Back   []\b\b");
	      scanf("%d",&w2);
	    }
	  }
         }
        while(w2==1);
      }
  menu();                                                /*调用菜单函数*/
}




/*************************时间点查找模块***********************/
int point_search()                                   /*时间点查找模块*/
{ int i,n,k,w1=1,w2,w3,w4;
  struct machine m;
  n=load();
  printf("Press 1-borrowin_time 2-borrowout_time or 3-return_time");
  scanf("%d",&i);                            /*选择要查找的是哪个时间点*/
  if(i==1)
   {do
     {do
       { k=-1;
      printf("\n\nEnter the machine borrowin time that you want to search!   borrowin time:");
           scanf("%s",m.time);             /*输入要查找的仪器仪表的借入时间*/
           printf_face();                      /*调用显示数据结构项目函数*/
           for(i=0;i<n;i++)                           /*查找想要的记录*/
           if(strcmp(m.time,mac[i].borrowin_time)==0)
             { k=i;                                /*找到要查找的记录*/
	       printf_one(k);                        /*调用显示一个记录的函数*/
             }
           if(k==-1)
             { printf("\n\nNO exist! please");
               printf("\n\nAre you again?\n\t1).again   2).NO and back  []\b\b");
               scanf("%d",&w1);
               while(w1==1) menu();/*保证第一次查找的基础上再查找找不到时能退出*/
             }
         }
          while(k==-1&&w1==1);                 /*如果w1!=1则直接返回*/
         w4=0;w3=0;
        if(k!=-1)                          /*k!=-1表示找到，如果找到则选择操作*/
          {printf("\n\nWhat do you want to do?\n\t1).Search another  2).Modify  3).Delete  4).Back menu  []\b\b");
           scanf("%d",&w2);
           switch(w2)
	      {case 2:w3=modify_data(k);break;          /*调用修改数据函数*/
	       case 3:{printf("\nAre you sure?\n\t1).Sure   2).No and back  []\b\b");
	       scanf("%d",&w4);
	      }
	    }
        if(w3==1||w4==1)
	  {save(n);
	   printf("\n\nSuccessful.^_^.");
	   printf("\n\nWhat do you want to do?\n\t1).Search another   2).Back   []\b\b");
	   scanf("%d",&w2);
	  }
	}
       }
      while(w2==1);
  }
   if(i==2)
     {do
         {do
            { k=-1;
              printf("\n\nEnter borrowout time:");
              scanf("%s",m.time);          /*输入要查找的仪器仪表的借出时间*/
              printf_face();                   /*调用显示数据结构项目函数*/
              for(i=0;i<n;i++)                      /*查找想要的记录*/
              if(strcmp(m.time,mac[i].borrowout_time)==0)
                { k=i;                           /*找到要查找的记录*/
	          printf_one(k);                     /*调用显示一个记录的函数*/
                }
               if(k==-1)
                 { printf("\n\nNO exist! please");
                   printf("\n\nAre you again?\n\t1).again   2).NO and back  []\b\b");
                   scanf("%d",&w1);
                while(w1==1)menu();/*保证第一次查找的基础上再查找找不到时能退出*/
                  }
             }
          while(k==-1&&w1==1);             /*如果w1!=1则直接返回*/
          w4=0;w3=0;
          if(k!=-1)                     /*k!=-1表示找到，如果找到则选择操作*/
            { printf("\n\nWhat do you want to do?\n\t1).Search another  2).Modify  3).Delete  4).Back menu  []\b\b");
              scanf("%d",&w2);
              switch(w2)
	          { case 2:w3=modify_data(k);break;     /*调用修改数据函数*/
	            case 3:{printf("\nAre you sure?\n\t1).Sure   2).No and back  []\b\b");
	            scanf("%d",&w4);
	           }
	    }
          if(w3==1||w4==1)
	    { save(n);
	      printf("\n\nSuccessful.^_^.");
	      printf("\n\nWhat do you want to do?\n\t1).Search another   2).Back   []\b\b");
	      scanf("%d",&w2);
	    }
	  }
         }
        while(w2==1);
      }
 if(i==3)
     {do
         {do
            { k=-1;
              printf("\n\nEnter return time:");
              scanf("%s",m.time);          /*输入要查找的仪器仪表的归还时间*/
              printf_face();                   /*调用显示数据结构项目函数*/
              for(i=0;i<n;i++)                       /*查找想要的记录*/
              if(strcmp(m.time,mac[i].return_time)==0)
                { k=i;                            /*找到要查找的记录*/
	          printf_one(k);                     /*调用显示一个记录的函数*/
                }
               if(k==-1)
                 { printf("\n\nNO exist! please");
                   printf("\n\nAre you again?\n\t1).again   2).NO and back  []\b\b");
                   scanf("%d",&w1);
               while(w1==1) menu();/*保证第一次查找的基础上再查找找不到时能退出*/
                  }
             }
          while(k==-1&&w1==1);                    /*如果w1!=1则直接返回*/
          w4=0;w3=0;
          if(k!=-1)                       /*k!=-1表示找到，如果找到则选择操作*/
            { printf("\n\nWhat do you want to do?\n\t1).Search another  2).Modify  3).Delete  4).Back menu  []\b\b");
              scanf("%d",&w2);
              switch(w2)
	          { case 2:w3=modify_data(k);break;       /*调用修改数据函数*/
	            case 3:{printf("\nAre you sure?\n\t1).Sure   2).No and back  []\b\b");
	            scanf("%d",&w4);
	           }
	    }
          if(w3==1||w4==1)
	    { save(n);
	      printf("\n\nSuccessful.^_^.");
	      printf("\n\nWhat do you want to do?\n\t1).Search another   2).Back   []\b\b");
	      scanf("%d",&w2);
	    }
	  }
         }
        while(w2==1);
      }
  menu();                                                /*调用菜单函数*/
}
/*************************修改模块***********************/
modify()                                         /*修改模块*/
{ struct machine m;
  FILE *fp;
  int i,n,k,w0=1,w1,w2=0;
  n=load();
  do
  { k=-1;                         /*给用户看全部记录以便确认要修改的记录*/
    printf_face();                        /*调用显示数据结构项目函数*/
    for(i=0;i<n;i++)
       {if((i!=0)&&(i%10==0))                     /*分屏显示*/
          {printf("\n\npass any key to continue...");
           getch();
           puts("\n\n");
           }
        printf_one(i);                       /*调用显示一个记录的函数*/
       }
    do
      { printf("\nplease enter machine number:");
	scanf("%s",m.number);                 /*输入要修改的仪器仪表的编号*/
        for(i=0;i<n;i++)                   /*查找要修改的仪器仪表的记录*/
	   if(strcmp(m.number,mac[i].number)==0)
	     { k=i;                              /*找到要修改的记录*/
	       m=mac[i];              /*把mac[i]备份给m，以便用户后悔时恢复*/
	      }
	if(k==-1)printf("\n\nNO exist!Try again");
       } while(k==-1);                        /*k==-1时表示没有找到*/
     printf_face();                         /*调用显示数据结构项目函数*/
     printf_one(k);                          /*调用显示一个记录的函数*/
     w1=modify_data(k); 
/*修改仪器仪表记录并且返回保存控制值w1,w1=1则表示用户以确认修改*/
     if(w1==1)                           /*w1==1表示用户确定这次修改*/
       { printf("\nSuccessful^_^.\n\nAre you modify another?\n\n\t1).Yes  2).Back with save\t[]\b\b");
	 scanf("%d",&w0);
	 w2=1;                          /*控制保存，使w2=1是标记已有过修改*/
	}
      else
	 { w0=0;
	   if(w2==1)
	   mac[k]=m;
	 }/*走到这里是由于用户没有确认这次修改（在调用修改函数w1=modify_data(k)时没有确认），使w0=0，为了终止循环；   mac[k]=m 则把备份的m恢复给mac[k]，这样的好处是确保在此之前修改过的成功保存，而本次不修改*/
     if(w0!=1&&w2==1) /*w0!=1则表示正常返回，w2=1表示在此之前有过修改，此时就保存用户已经确认修改的并返回*/
       save(n); /*w2!=1表示在此次之前没有修改过，而又反悔这次修改，则不保存返回*/
 }
 while(w0==1);
 printf_back();


   /*************************删除模块***********************/
delete()                                             /*删除模块*/
{ struct machine m;
  FILE *fp;
  int i,n,k,w0=1,w1,w2=0;
  n=load();                    /*给用户看全部记录以便确认要删除的记录*/
  do
  {k=-1;
    printf_face();                   /*调用显示数据结构项目函数*/
    for(i=0;i<n;i++)                    
       {if((i!=0)&&(i%10==0))            /*分屏显示*/
          {printf("\n\npass any key to continue...");
           getch();
           puts("\n\n");
           }
        printf_one(i);               /*调用显示一个记录的函数*/
       }
do
      { printf("\nplease enter machine number you want to delete:");
	scanf("%s",m.number);           /*输入要删除的仪器仪表的编号*/
        for(i=0;i<n;i++)             /*查找要删除的仪器仪表的记录*/
	   if(strcmp(m.number,mac[i].number)==0)
	     { k=i;                         /*找到要修改的记录*/
	       m=mac[i];          /*把mac[i]备份给m，以便用户后悔时恢复*/
	      }
	if(k==-1)printf("\n\nNO exist!Try again");
       } while(k==-1);                  /*k==-1时表示没有找到*/
     printf_face();                     /*调用显示数据结构项目函数*/
     printf_one(k);                      /*调用显示一个记录的函数*/
     printf("\nAre you sure?\n\n\t1).Sure 2).Back without save in this time  []\b\b");
     scanf("%d",&w1);         /*返回保存控制值w1,w1=1则表示用户以确认要删除*/
     if(w1==1)                       /*w1==1表示用户确定这次删除*/
       { mac[k].number=0;             /* mac[k].number=0表示已经删除*/
	 printf("\nSuccessful^_^.\n\nAre you delete another?\n\n\t1).Yes  2).Back with save\t[]\b\b");
	 scanf("%d",&w0);
	 w2=1;                       /*控制保存，使w2=1是标记已有过修改*/
	}
      else
	 { w0=0;
	   if(w2==1)
	   mac[k]=m;
	 } /*走到这里是由于用户没有确认这次删除，使w0=0，为了终止循环mac[k]=m 则把备份的m恢复给mac[k]，这样的好处是确保在此之前删除过的成功保存，而本次不删除*/
     if(w0!=1&&w2==1) /*w0!=1则表示正常返回，w2=1表示在此之前有过删除，此时就保存用户已经确认删除的并返回*/
       save(n); /*w2!=1表示在此次之前没有删除过，而又反悔这次删除，则不保存返回*/
 }
 while(w0==1);
 printf_back();
}
